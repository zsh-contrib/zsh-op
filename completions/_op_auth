#!/usr/bin/env zsh
#compdef op-auth

# Completion for op-auth command

_op_auth() {
    local -a profiles

    # Options
    local -a options
    options=(
        '(-e --expiration)'{-e,--expiration}'[SSH key expiration time]:expiration:(30m 1h 2h 4h 8h 12h 24h)'
        '(-c --config)'{-c,--config}'[Config file path]:config file:_files'
        '(-r --refresh)'{-r,--refresh}'[Force refresh from 1Password]'
        '(-h --help)'{-h,--help}'[Show help message]'
    )

    # Try to load config and get profiles
    if [[ -f "${ZSH_OP_CONFIG_FILE:-$HOME/.config/op/config.yml}" ]]; then
        # Load config silently
        _zsh_op_load_config "${ZSH_OP_CONFIG_FILE:-$HOME/.config/op/config.yml}" 2>/dev/null
        # Get profile names
        profiles=($(_zsh_op_get_profiles 2>/dev/null))
    fi

    # If no profiles found, use defaults
    if [[ ${#profiles[@]} -eq 0 ]]; then
        profiles=(personal work)
    fi

    _arguments -s -S \
        $options \
        "1:profile:(${profiles[*]})"
}

_op_auth "$@"
